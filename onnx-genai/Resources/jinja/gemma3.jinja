{{ bos_token }}
{% if messages[0]['role'] == 'system' %}
    {{ '<start_of_turn>user\n' + messages[0]['content'] | trim + '\n' + messages[1]['content'] | trim + '<end_of_turn>\n' }}
    {% set loop_messages = messages[2:] %}
{% else %}
    {% set loop_messages = messages %}
{% endif %}
{% for message in loop_messages %}
    {{ '<start_of_turn>' + message['role'] + '\n' + message['content'] | trim + '<end_of_turn>\n' }}
{% endfor %}
{% if add_generation_prompt %}
    {{ '<start_of_turn>model\n' }}
{% endif %}